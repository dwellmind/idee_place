<h1>Listing Ideas</h1>

<form id="ideas-search" phx-submit="search">
  <%= text_input :search, :query,
      value: @query,
      placeholder: "Search...",
      autofocus: true %>
  <%= submit "Search", phx_disable_with: "Searching..." %>
</form>

<%= if Enum.empty?(@ideas_page.entries) do %>
  <%= if @query == "" do %>
    <div>No ideas yet.</div>
  <% else %>
    <div>The query does not match any ideas.</div>
  <% end %>
<% else %>
  <table>
    <thead>
      <tr>
        <%= if @current_user do %>
          <th></th>
        <% end %>
        <th>Author</th>
        <th>Title</th>
      </tr>
    </thead>
    <tbody>
      <%= for idea <- @ideas_page.entries do %>
        <tr>
          <%= if @current_user do %>
            <td>
              <%= if Enum.any?(@starred_ideas_id, fn starred_idea_id -> starred_idea_id == idea.id end) do %>
                <img src=<%= Routes.static_path(@socket, "/assets/icons/starred.png") %>/>
              <% end %>
            </td>
          <% end %>
          <td><%= idea.author.name %></td>
          <td>
            <a href=<%= Routes.idea_path(@socket, :show, idea) %>>
              <div><%= idea.title %></div>
            </a>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <nav aria-label="Page navigation example">
    <ul class="inline-flex -space-x-px list-none">
      <li>
        <%= if @ideas_page.page_number > 1 do %>
          <a
            href="#"
            phx-click="previous_page"
            phx-value-query="<%= @query %>"
            class="py-2 px-3 ml-0 leading-tight text-gray-500 bg-white rounded-l-lg border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
          >
            Previous
          </a>
        <% else %>
          <span
            class="py-2 px-3 ml-0 leading-tight text-gray-500 bg-white rounded-l-lg border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
          >
            Previous
          </span>
        <% end %>
      </li>
      <%= for page_index <- 1..@ideas_page.total_pages do %>
        <li>
          <a
            href="#"
            phx-click="go_to_page"
            phx-value-page=<%= page_index %>
            phx-value-query="<%= @query %>"
            class="py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
          >
            <%= page_index %>
          </a>
        </li>
      <% end %>
      <li>
        <%= if @ideas_page.page_number < @ideas_page.total_pages do %>
          <a
            href="#"
            phx-click="next_page"
            phx-value-query="<%= @query %>"
            class="py-2 px-3 leading-tight text-gray-500 bg-white rounded-r-lg border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
          >
          Next
          </a>
        <% else %>
          <span
            class="py-2 px-3 leading-tight text-gray-500 bg-white rounded-r-lg border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
          >
            Next
          </span>
        <% end %>
      </li>
    </ul>
  </nav>
<% end %>
